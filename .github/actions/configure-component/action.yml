name: 'Configure Component'
description: 'Configure un composant sp√©cifique de l infrastructure'

inputs:
  component:
    description: 'Composant √† configurer (sonarqube, jenkins-master, jenkins-agent)'
    required: true
  component_ip:
    description: 'IP du composant √† configurer'
    required: true
  should_configure:
    description: 'Indique si le composant doit √™tre configur√©'
    required: true
    default: 'false'

runs:
  using: 'composite'
  steps:
    - name: Configure Component
      if: inputs.should_configure == 'true'
      shell: bash
      run: |
        echo "üîß Configuration de ${{ inputs.component }} sur ${{ inputs.component_ip }}"
        
        case "${{ inputs.component }}" in
          "sonarqube")
            chmod +x scripts/deploy_sonarqube.sh
            ./scripts/deploy_sonarqube.sh
            echo "‚úÖ SonarQube configur√© avec succ√®s: http://${{ inputs.component_ip }}:9000"
            ;;
          "jenkins-master")
            chmod +x scripts/deploy_jenkins_master.sh
            ./scripts/deploy_jenkins_master.sh
            echo "‚úÖ Jenkins Master configur√© avec succ√®s: http://${{ inputs.component_ip }}:8080"
            ;;
          "jenkins-agent")
            chmod +x scripts/deploy_jenkins_agent.sh
            ./scripts/deploy_jenkins_agent.sh
            echo "‚úÖ Jenkins Agent configur√© avec succ√®s et connect√© au master"
            ;;
          *)
            echo "‚ùå Composant non reconnu: ${{ inputs.component }}"
            exit 1
            ;;
        esac
      env:
        ANSIBLE_HOST_KEY_CHECKING: False
